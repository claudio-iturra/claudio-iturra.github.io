<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Time Series Spectral Analysis</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fft-js/0.0.12/fft.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .input-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #555;
        }
        
        textarea {
            width: 100%;
            height: 120px;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            resize: vertical;
            transition: border-color 0.3s ease;
        }
        
        textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        input[type="number"] {
            width: 200px;
            padding: 10px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }
        
        input[type="number"]:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: #f8f9fa;
            color: #495057;
            border: 2px solid #dee2e6;
        }
        
        .btn-secondary:hover {
            background: #e9ecef;
            transform: translateY(-1px);
        }
        
        .results-section {
            display: none;
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .chart-container {
            margin-bottom: 30px;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
        }
        
        .chart-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: #495057;
            text-align: center;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üåä Time Series Spectral Analysis</h1>
            <p>Analyze your time series data with FFT spectral analysis and continuous wavelet transform by Claudio Iturra</p>
        </div>
        
        <div class="input-section">
            <div class="input-group">
                <label for="timeSeries">Time Series Data (one value per line or comma-separated):</label>
                <textarea id="timeSeries" placeholder="Enter your time series data here...">12
11
9
7
6
6
4
5
6
5
4
4
5
6
7
10
12
12
14
16
17
15
16
15
13
12
8
8
8
7
9
7
6
3
6
7
7
8
8
9
10
10
13
14
14
17
15
12
10
5
5
3
6
3
5
7
6
6
5
4
5
5
7
8
10
9
8
10
11
9
10
10
7
8
7
7
7
5
6
6
5
4
3
3
4
5
5
3
6
6
6
7
5
8
6
4
5
4
6
7
3
3
4
5
5
5
5
6
5
3
6
9
9
9
10
7
9
9
6
4
6
4
6
4
6
3
4
3
0
3
3
4
8
8
9
11
12
9
13
14
11
11
9
10
8
6
5
4
3
3
4
4
4
2
3
2
5
10
9
7
5
11
12
11
8
10
7
8
10
10
12
12
10
8
7
8
7
8
6
3
6
7
6
7
7
11
9
12
14
15
16
13
14
11
12
10
6
7
8
8
5
5
6
8
8
10
10
12
12
11
13
16
17
17
17
16
14
13
14
10
7
6
7
7
8
5
6
6
6
4
3
7
9
10
12
13
11
13
14
14
11
13
11
8
9
8
5
4
4
6
2
9
5
8
4
8
8
11
11
14
15
16
18
16
12
13
11
6
6
4
8
6
7
9
8
7
8
6
5
7
10
14
11
12
14
15
16
15
15
15
15
11
8
9
9
8
6
5
6
8
4
4
8
8
11
9
11
13
13
14
14
12
13
15
13
9
7
5
5
5
4
3
2
5
5
3
3
6
9
10
10
11
11
12
10
6
6
3
4
4
6
6
3
5
5
7
6
5
5
6
8
8
8
8
9
7
4
6
6
4
3
6
8
7
9
9
8
6
8
7
6
9
5
7
8
10
8
9
11
13
16
16
16
13
15
13
12
13
11
8
6
8
6
3
1
3
3
3
3
5
6
8
12
15
14
16
17
16
16
15
14
12
9
8
7
7
9
7
6
6
5
6
9
8
8
10
13
14
15
14
15
13
15
12
10
10
6
6
6
6
6
7
9
6
8
7
6
8
9
11
11
12
16
13
10
14
6
9
6
8
6
10
11
8
4
3
3
3
9
6
9
7
9
10
12
14
17
13
10
11
11
9
5
7
7
3
2
6
6
4
5
5
6
6
8
10
11
12
11
11
9
10
9
9
10
7
9
9
10
8
7
5
2
1
1
2
6
7
7
9
10
9
11
13
10
10
10
8
7
4
1
4
4
3
2
3
0
2
2
3
2
3
5
4
6
6
7
9
11
16
15
17
16
15
12
13
10
9
6
3
5
7
6
4
10
12
16
11
12
14
18
18
19
19
17
16
12
9
9
9
9
6
8
6
7
6
5
4
3
3
3
8
6
6
10
14
14
14
16
15
13
11
10
6
6
7
7
9
4
5
2
4
9
9
10
11
11
11
14
12
14
14
16
16
9
7
4
4
3
4
3
2
1
1
6
7
9
10
9
12
14
16
17
20
18
17
18
14
13
9
8
8
8
9
6
5
5
5
6
2
4
5
4
8
8
11
13
16
17
16
16
15
14
10
6
7
8
6
6
6
7
8
8
7
6
7
7
7
9
8
6
7
9
7
5
7
4
3
8
6
4
6
5
4
0
2
2
5
5
4
4
8
11
10
9
10
12
12
12
12
11
8
8
6
7
6
5
3
3
4
5
3
5
6
10
11
13
14
14
14
14
17
15
14</textarea>
            </div>
            
            <div class="input-group">
                <label for="resolution">Temporal Resolution (hours):</label>
                <input type="number" id="resolution" value="1" min="0.1" step="0.1">
            </div>
            
            <div class="button-group">
                <button class="btn-primary" onclick="analyzeTimeSeries()">üî¨ Analyze Time Series</button>
                <button class="btn-secondary" onclick="loadSampleData()">üìä Load Sample Data</button>
                <button class="btn-secondary" onclick="clearData()">üóëÔ∏è Clear Data</button>
            </div>
        </div>
        
        <div id="results" class="results-section">
            <div class="chart-container">
                <div class="chart-title">üìà Original Time Series</div>
                <div id="timeSeriesPlot"></div>
            </div>
            
            <div class="chart-container">
                <div class="chart-title">üåà Power Spectral Density (Period in hours)</div>
                <div id="spectrumPlot"></div>
            </div>
            
            <div class="chart-container">
                <div class="chart-title">üåä Continuous Wavelet Transform Scalogram (Period in hours)</div>
                <div id="waveletPlot"></div>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="meanValue">-</div>
                    <div class="stat-label">Mean Value</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stdValue">-</div>
                    <div class="stat-label">Standard Deviation</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="dominantPeriod">-</div>
                    <div class="stat-label">Dominant Period (hours)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="dominantFreq">-</div>
                    <div class="stat-label">Dominant Frequency (cycles/hour)</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Morlet wavelet function
        function morletWavelet(t, scale, omega0 = 6) {
            const norm = Math.pow(Math.PI, -0.25) * Math.sqrt(2 / scale);
            const exp1 = Math.exp(-0.5 * Math.pow(t / scale, 2));
            const cosine = Math.cos(omega0 * t / scale);
            return norm * exp1 * cosine;
        }

        // Continuous Wavelet Transform (simplified)
        function cwt(signal, scales, dt = 1) {
            const N = signal.length;
            const coefficients = [];
            
            for (let scaleIdx = 0; scaleIdx < scales.length; scaleIdx++) {
                const scale = scales[scaleIdx];
                const coeff = [];
                
                for (let n = 0; n < N; n++) {
                    let sum = 0;
                    const windowSize = Math.min(Math.floor(scale * 6), N);
                    
                    for (let k = Math.max(0, n - windowSize); k < Math.min(N, n + windowSize); k++) {
                        const t = (k - n) * dt;
                        const wavelet = morletWavelet(t, scale);
                        sum += signal[k] * wavelet;
                    }
                    coeff.push(Math.abs(sum));
                }
                coefficients.push(coeff);
            }
            
            return coefficients;
        }

        // Improved DFT for power spectrum
        function computePowerSpectrum(data, sampleRate) {
            const N = data.length;
            const frequencies = [];
            const power = [];
            
            // Remove DC component and detrend
            const mean = data.reduce((a, b) => a + b, 0) / N;
            const detrendedData = data.map(x => x - mean);
            
            // Apply simple window function
            const windowedData = detrendedData.map((x, i) => {
                const window = 0.5 - 0.5 * Math.cos(2 * Math.PI * i / (N - 1)); // Hanning window
                return x * window;
            });
            
            // Compute DFT
            for (let k = 0; k < Math.floor(N/2); k++) {
                const freq = k * sampleRate / N;
                frequencies.push(freq);
                
                let realSum = 0;
                let imagSum = 0;
                
                for (let n = 0; n < N; n++) {
                    const angle = -2 * Math.PI * k * n / N;
                    realSum += windowedData[n] * Math.cos(angle);
                    imagSum += windowedData[n] * Math.sin(angle);
                }
                
                const magnitude = Math.sqrt(realSum * realSum + imagSum * imagSum);
                power.push(magnitude * magnitude / N);
            }
            
            return { frequencies, power };
        }

        function analyzeTimeSeries() {
            try {
                const input = document.getElementById('timeSeries').value.trim();
                const resolution = parseFloat(document.getElementById('resolution').value);
                
                if (!input) {
                    alert('Please enter time series data');
                    return;
                }
                
                if (isNaN(resolution) || resolution <= 0) {
                    alert('Please enter a valid temporal resolution');
                    return;
                }
                
                // Parse input data
                let data;
                if (input.includes(',')) {
                    data = input.split(',').map(x => parseFloat(x.trim())).filter(x => !isNaN(x));
                } else {
                    data = input.split('\n').map(x => parseFloat(x.trim())).filter(x => !isNaN(x));
                }
                
                if (data.length < 4) {
                    alert('Please provide at least 4 data points');
                    return;
                }
                
                console.log(`Processing ${data.length} data points with resolution ${resolution} hours`);
            
            // Calculate statistics
            const mean = data.reduce((a, b) => a + b, 0) / data.length;
            const variance = data.reduce((a, b) => a + Math.pow(b - mean, 2), 0) / data.length;
            const std = Math.sqrt(variance);
            
            // Create time axis
            const timeAxis = data.map((_, i) => i * resolution);
            
            // Plot original time series
            const timeSeriesTrace = {
                x: timeAxis,
                y: data,
                type: 'scatter',
                mode: 'lines+markers',
                name: 'Time Series',
                line: { color: '#667eea', width: 2 },
                marker: { size: 4, color: '#764ba2' }
            };
            
            Plotly.newPlot('timeSeriesPlot', [timeSeriesTrace], {
                xaxis: { title: 'Time (hours)' },
                yaxis: { title: 'Value' },
                margin: { t: 20, r: 20, b: 40, l: 50 }
            });
            
            // Compute power spectrum
            const sampleRate = 1 / resolution; // samples per hour
            const spectrum = computePowerSpectrum(data, sampleRate);
            
            // Find dominant frequency
            let maxPowerIdx = 0;
            for (let i = 1; i < spectrum.power.length; i++) {
                if (spectrum.power[i] > spectrum.power[maxPowerIdx]) {
                    maxPowerIdx = i;
                }
            }
            const dominantFreq = spectrum.frequencies[maxPowerIdx];
            const dominantPeriod = dominantFreq > 0 ? 1 / dominantFreq : Infinity;
            
            // Convert frequencies to periods (in hours)
            const periods = spectrum.frequencies.slice(1).map(f => 1/f); // Skip DC component
            const powerNoDC = spectrum.power.slice(1);
            
            // Plot power spectrum vs period
            const spectrumTrace = {
                x: periods,
                y: powerNoDC,
                type: 'scatter',
                mode: 'lines',
                name: 'Power Spectrum',
                line: { color: '#e74c3c', width: 2 },
                fill: 'tonexty',
                fillcolor: 'rgba(231, 76, 60, 0.2)'
            };
            
            Plotly.newPlot('spectrumPlot', [spectrumTrace], {
                xaxis: { title: 'Period (hours)', type: 'log' },
                yaxis: { title: 'Power' },
                margin: { t: 20, r: 20, b: 40, l: 50 }
            });
            
            // Compute wavelet transform with better scale selection
            const minScale = 2 * resolution;
            const maxScale = Math.min(data.length * resolution / 8, 100 * resolution);
            const numScales = 30;
            const scales = [];
            for (let i = 0; i < numScales; i++) {
                const logScale = Math.log(minScale) + (Math.log(maxScale) - Math.log(minScale)) * i / (numScales - 1);
                scales.push(Math.exp(logScale));
            }
            
            console.log('Computing wavelet transform...');
            const waveletCoeffs = cwt(data, scales, resolution);
            
            // Convert scales to periods (for Morlet wavelet with omega0=6)
            const waveletPeriods = scales.map(scale => 2 * Math.PI * scale / 6);
            
            // Plot wavelet scalogram
            const waveletTrace = {
                z: waveletCoeffs,
                x: timeAxis,
                y: waveletPeriods,
                type: 'heatmap',
                colorscale: 'Viridis',
                showscale: true,
                colorbar: { title: 'Magnitude' }
            };
            
            Plotly.newPlot('waveletPlot', [waveletTrace], {
                xaxis: { title: 'Time (hours)' },
                yaxis: { title: 'Period (hours)', type: 'log' },
                margin: { t: 20, r: 20, b: 40, l: 50 }
            });
            
            // Update statistics
            document.getElementById('meanValue').textContent = mean.toFixed(2);
            document.getElementById('stdValue').textContent = std.toFixed(2);
            document.getElementById('dominantFreq').textContent = dominantFreq.toFixed(4);
            document.getElementById('dominantPeriod').textContent = 
                dominantPeriod === Infinity ? '‚àû' : dominantPeriod.toFixed(1);
            
            // Show results
            document.getElementById('results').style.display = 'block';
            document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
            
            } catch (error) {
                console.error('Analysis error:', error);
                alert('An error occurred during analysis. Please check your data format and try again.');
            }
        }
        
        function loadSampleData() {
            const sampleData = `12
11
9
7
6
6
4
5
6
5
4
4
5
6
7
10
12
12
14
16
17
15
16
15
13
12
8
8
8
7
9
7
6
3
6
7
7
8
8
9
10
10
13
14
14
17
15
12
10
5
5
3
6
3
5
7
6
6
5
4
5
5
7
8
10
9
8
10
11
9
10
10
7
8
7
7
7
5
6
6
5
4
3
3
4
5
5
3
6
6
6
7
5
8
6
4
5
4
6
7
3
3
4
5
5
5
5
6
5
3
6
9
9
9
10
7
9
9
6
4
6
4
6
4
6
3
4
3
0
3
3
4
8
8
9
11
12
9
13
14
11
11
9
10
8
6
5
4
3
3
4
4
4
2
3
2
5
10
9
7
5
11
12
11
8
10
7
8
10
10
12
12
10
8
7
8
7
8
6
3
6
7
6
7
7
11
9
12
14
15
16
13
14
11
12
10
6
7
8
8
5
5
6
8
8
10
10
12
12
11
13
16
17
17
17
16
14
13
14
10
7
6
7
7
8
5
6
6
6
4
3
7
9
10
12
13
11
13
14
14
11
13
11
8
9
8
5
4
4
6
2
9
5
8
4
8
8
11
11
14
15
16
18
16
12
13
11
6
6
4
8
6
7
9
8
7
8
6
5
7
10
14
11
12
14
15
16
15
15
15
15
11
8
9
9
8
6
5
6
8
4
4
8
8
11
9
11
13
13
14
14
12
13
15
13
9
7
5
5
5
4
3
2
5
5
3
3
6
9
10
10
11
11
12
10
6
6
3
4
4
6
6
3
5
5
7
6
5
5
6
8
8
8
8
9
7
4
6
6
4
3
6
8
7
9
9
8
6
8
7
6
9
5
7
8
10
8
9
11
13
16
16
16
13
15
13
12
13
11
8
6
8
6
3
1
3
3
3
3
5
6
8
12
15
14
16
17
16
16
15
14
12
9
8
7
7
9
7
6
6
5
6
9
8
8
10
13
14
15
14
15
13
15
12
10
10
6
6
6
6
6
7
9
6
8
7
6
8
9
11
11
12
16
13
10
14
6
9
6
8
6
10
11
8
4
3
3
3
9
6
9
7
9
10
12
14
17
13
10
11
11
9
5
7
7
3
2
6
6
4
5
5
6
6
8
10
11
12
11
11
9
10
9
9
10
7
9
9
10
8
7
5
2
1
1
2
6
7
7
9
10
9
11
13
10
10
10
8
7
4
1
4
4
3
2
3
0
2
2
3
2
3
5
4
6
6
7
9
11
16
15
17
16
15
12
13
10
9
6
3
5
7
6
4
10
12
16
11
12
14
18
18
19
19
17
16
12
9
9
9
9
6
8
6
7
6
5
4
3
3
3
8
6
6
10
14
14
14
16
15
13
11
10
6
6
7
7
9
4
5
2
4
9
9
10
11
11
11
14
12
14
14
16
16
9
7
4
4
3
4
3
2
1
1
6
7
9
10
9
12
14
16
17
20
18
17
18
14
13
9
8
8
8
9
6
5
5
5
6
2
4
5
4
8
8
11
13
16
17
16
16
15
14
10
6
7
8
6
6
6
7
8
8
7
6
7
7
7
9
8
6
7
9
7
5
7
4
3
8
6
4
6
5
4
0
2
2
5
5
4
4
8
11
10
9
10
12
12
12
12
11
8
8
6
7
6
5
3
3
4
5
3
5
6
10
11
13
14
14
14
14
17
15
14`;
            
            document.getElementById('timeSeries').value = sampleData;
            document.getElementById('resolution').value = '1';
        }
        
        function clearData() {
            document.getElementById('timeSeries').value = '';
            document.getElementById('resolution').value = '1';
            document.getElementById('results').style.display = 'none';
        }
        
        // Load sample data on page load
        window.onload = function() {
            loadSampleData();
        };
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'971b284ad27d88ac',t:'MTc1NTYyMjMwNC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coastal Ocean Biogeochemical Model</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: #87CEEB;
        }
        
        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .model-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .process-card {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 15px;
            padding: 25px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: transform 0.3s ease;
        }
        
        .process-card:hover {
            transform: translateY(-5px);
        }
        
        .process-card h3 {
            color: #87CEEB;
            margin-bottom: 15px;
            font-size: 1.4rem;
        }
        
        .equation {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            border-left: 4px solid #87CEEB;
        }
        
        .parameters {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 20px 0;
        }
        
        .param-group {
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 8px;
        }
        
        .param-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #B0E0E6;
        }
        
        .param-group input {
            width: 100%;
            padding: 8px;
            border: none;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
        }
        
        .calculate-btn {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: all 0.3s ease;
            margin: 10px 5px;
        }
        
        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
        }
        
        .results {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border-left: 4px solid #4CAF50;
        }
        
        .chart-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            color: #333;
        }
        
        .depth-profile {
            grid-column: 1 / -1;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 15px;
            padding: 25px;
            backdrop-filter: blur(10px);
        }
        
        .environmental-params {
            grid-column: 1 / -1;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 15px;
            padding: 25px;
            backdrop-filter: blur(10px);
        }
        
        .env-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        @media (max-width: 768px) {
            .model-grid {
                grid-template-columns: 1fr;
            }
            
            .parameters {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üåä Coastal Ocean Biogeochemical Model</h1>
            <p>Interactive modeling of biogeochemical processes in coastal waters (100m depth) by Claudio Iturra</p>
        </div>
        
        <div class="environmental-params">
            <h3>üå°Ô∏è Environmental Parameters</h3>
            <div class="env-grid">
                <div class="param-group">
                    <label>Temperature (¬∞C)</label>
                    <input type="number" id="temperature" value="15" step="0.1">
                </div>
                <div class="param-group">
                    <label>Salinity (PSU)</label>
                    <input type="number" id="salinity" value="35" step="0.1">
                </div>
                <div class="param-group">
                    <label>pH</label>
                    <input type="number" id="ph" value="8.1" step="0.01">
                </div>
                <div class="param-group">
                    <label>Light Attenuation (m‚Åª¬π)</label>
                    <input type="number" id="lightAtten" value="0.15" step="0.01">
                </div>
                <div class="param-group">
                    <label>Mixed Layer Depth (m)</label>
                    <input type="number" id="mixedLayer" value="20" step="1">
                </div>
                <div class="param-group">
                    <label>Current Velocity (m/s)</label>
                    <input type="number" id="currentVel" value="0.1" step="0.01">
                </div>
            </div>
        </div>

        <div class="model-grid">
            <div class="process-card">
                <h3>ü¶† Primary Production</h3>
                <div class="equation">
                    PP = Pmax √ó (I/Ik) √ó exp(1 - I/Ik) √ó f(T) √ó f(N)
                    <br><br>
                    Where:<br>
                    ‚Ä¢ Pmax = Maximum photosynthetic rate<br>
                    ‚Ä¢ I = Light intensity at depth<br>
                    ‚Ä¢ Ik = Light saturation parameter<br>
                    ‚Ä¢ f(T) = Temperature function<br>
                    ‚Ä¢ f(N) = Nutrient limitation
                </div>
                
                <div class="parameters">
                    <div class="param-group">
                        <label>Pmax (mg C m‚Åª¬≥ h‚Åª¬π)</label>
                        <input type="number" id="pmax" value="5.0" step="0.1">
                    </div>
                    <div class="param-group">
                        <label>Ik (Œºmol photons m‚Åª¬≤ s‚Åª¬π)</label>
                        <input type="number" id="ik" value="100" step="1">
                    </div>
                    <div class="param-group">
                        <label>Surface Light (Œºmol m‚Åª¬≤ s‚Åª¬π)</label>
                        <input type="number" id="surfaceLight" value="1000" step="10">
                    </div>
                    <div class="param-group">
                        <label>Nitrate (ŒºM)</label>
                        <input type="number" id="nitrate" value="10" step="0.1">
                    </div>
                </div>
                
                <button class="calculate-btn" onclick="calculatePrimaryProduction()">Calculate Primary Production</button>
                <div id="ppResults" class="results" style="display:none;"></div>
            </div>

            <div class="process-card">
                <h3>üçÉ Respiration & Decomposition</h3>
                <div class="equation">
                    R = R‚ÇÄ √ó Q‚ÇÅ‚ÇÄ^((T-T‚ÇÄ)/10) √ó [DOC]
                    <br><br>
                    Decomposition:<br>
                    dDOC/dt = -k √ó [DOC] √ó f(T) √ó f(O‚ÇÇ)
                    <br><br>
                    Where:<br>
                    ‚Ä¢ R‚ÇÄ = Base respiration rate<br>
                    ‚Ä¢ Q‚ÇÅ‚ÇÄ = Temperature coefficient<br>
                    ‚Ä¢ k = Decomposition rate constant
                </div>
                
                <div class="parameters">
                    <div class="param-group">
                        <label>R‚ÇÄ (mg C m‚Åª¬≥ h‚Åª¬π)</label>
                        <input type="number" id="r0" value="0.5" step="0.01">
                    </div>
                    <div class="param-group">
                        <label>Q‚ÇÅ‚ÇÄ</label>
                        <input type="number" id="q10" value="2.0" step="0.1">
                    </div>
                    <div class="param-group">
                        <label>DOC (mg C L‚Åª¬π)</label>
                        <input type="number" id="doc" value="2.0" step="0.1">
                    </div>
                    <div class="param-group">
                        <label>k (day‚Åª¬π)</label>
                        <input type="number" id="kDecomp" value="0.1" step="0.01">
                    </div>
                </div>
                
                <button class="calculate-btn" onclick="calculateRespiration()">Calculate Respiration</button>
                <div id="respResults" class="results" style="display:none;"></div>
            </div>

            <div class="process-card">
                <h3>üîÑ Nitrogen Cycling</h3>
                <div class="equation">
                    Nitrification: NH‚ÇÑ‚Å∫ + O‚ÇÇ ‚Üí NO‚ÇÇ‚Åª + H‚ÇÇO + H‚Å∫<br>
                    Rate = k_nit √ó [NH‚ÇÑ‚Å∫] √ó [O‚ÇÇ] √ó f(T)
                    <br><br>
                    Denitrification: NO‚ÇÉ‚Åª ‚Üí N‚ÇÇO ‚Üí N‚ÇÇ<br>
                    Rate = k_denit √ó [NO‚ÇÉ‚Åª] √ó f(O‚ÇÇ) √ó f(T)
                    <br><br>
                    N‚ÇÇ Fixation: N‚ÇÇ + 8H‚Å∫ + 8e‚Åª ‚Üí 2NH‚ÇÉ + H‚ÇÇ<br>
                    Rate = k_fix √ó f(T) √ó f(Fe)
                </div>
                
                <div class="parameters">
                    <div class="param-group">
                        <label>NH‚ÇÑ‚Å∫ (ŒºM)</label>
                        <input type="number" id="nh4" value="2.0" step="0.1">
                    </div>
                    <div class="param-group">
                        <label>NO‚ÇÉ‚Åª (ŒºM)</label>
                        <input type="number" id="no3" value="15.0" step="0.1">
                    </div>
                    <div class="param-group">
                        <label>O‚ÇÇ (ŒºM)</label>
                        <input type="number" id="o2" value="250" step="1">
                    </div>
                    <div class="param-group">
                        <label>k_nit (day‚Åª¬π)</label>
                        <input type="number" id="kNit" value="0.2" step="0.01">
                    </div>
                </div>
                
                <button class="calculate-btn" onclick="calculateNitrogen()">Calculate N Cycling</button>
                <div id="nResults" class="results" style="display:none;"></div>
            </div>

            <div class="process-card">
                <h3>ü´ß Carbon System</h3>
                <div class="equation">
                    CO‚ÇÇ + H‚ÇÇO ‚áå H‚ÇÇCO‚ÇÉ ‚áå HCO‚ÇÉ‚Åª + H‚Å∫ ‚áå CO‚ÇÉ¬≤‚Åª + 2H‚Å∫
                    <br><br>
                    DIC = [CO‚ÇÇ] + [HCO‚ÇÉ‚Åª] + [CO‚ÇÉ¬≤‚Åª]<br>
                    Alk = [HCO‚ÇÉ‚Åª] + 2[CO‚ÇÉ¬≤‚Åª] + [OH‚Åª] - [H‚Å∫]
                    <br><br>
                    Air-Sea CO‚ÇÇ flux:<br>
                    F = k √ó K‚ÇÄ √ó (pCO‚ÇÇ_air - pCO‚ÇÇ_sea)
                </div>
                
                <div class="parameters">
                    <div class="param-group">
                        <label>DIC (Œºmol kg‚Åª¬π)</label>
                        <input type="number" id="dic" value="2100" step="1">
                    </div>
                    <div class="param-group">
                        <label>Alkalinity (Œºmol kg‚Åª¬π)</label>
                        <input type="number" id="alk" value="2300" step="1">
                    </div>
                    <div class="param-group">
                        <label>pCO‚ÇÇ air (Œºatm)</label>
                        <input type="number" id="pco2Air" value="410" step="1">
                    </div>
                    <div class="param-group">
                        <label>Wind Speed (m/s)</label>
                        <input type="number" id="windSpeed" value="5" step="0.1">
                    </div>
                </div>
                
                <button class="calculate-btn" onclick="calculateCarbon()">Calculate Carbon System</button>
                <div id="carbonResults" class="results" style="display:none;"></div>
            </div>

            <div class="process-card">
                <h3>‚ö° Redox Processes</h3>
                <div class="equation">
                    Sulfate Reduction:<br>
                    SO‚ÇÑ¬≤‚Åª + 2CH‚ÇÇO ‚Üí H‚ÇÇS + 2HCO‚ÇÉ‚Åª
                    <br><br>
                    Iron Cycling:<br>
                    Fe¬≥‚Å∫ + e‚Åª ‚Üí Fe¬≤‚Å∫ (reduction)<br>
                    Fe¬≤‚Å∫ + ¬ºO‚ÇÇ + H‚Å∫ ‚Üí Fe¬≥‚Å∫ + ¬ΩH‚ÇÇO (oxidation)
                    <br><br>
                    Rate = k_redox √ó [Substrate] √ó f(O‚ÇÇ) √ó f(T)
                </div>
                
                <div class="parameters">
                    <div class="param-group">
                        <label>SO‚ÇÑ¬≤‚Åª (mM)</label>
                        <input type="number" id="so4" value="28" step="0.1">
                    </div>
                    <div class="param-group">
                        <label>Fe¬≤‚Å∫ (ŒºM)</label>
                        <input type="number" id="fe2" value="0.5" step="0.01">
                    </div>
                    <div class="param-group">
                        <label>H‚ÇÇS (ŒºM)</label>
                        <input type="number" id="h2s" value="0.1" step="0.01">
                    </div>
                    <div class="param-group">
                        <label>k_redox (day‚Åª¬π)</label>
                        <input type="number" id="kRedox" value="0.05" step="0.001">
                    </div>
                </div>
                
                <button class="calculate-btn" onclick="calculateRedox()">Calculate Redox</button>
                <div id="redoxResults" class="results" style="display:none;"></div>
            </div>

            <div class="process-card">
                <h3>üåä Physical Transport</h3>
                <div class="equation">
                    Advection: ‚àÇC/‚àÇt = -u‚àÇC/‚àÇx - v‚àÇC/‚àÇy - w‚àÇC/‚àÇz
                    <br><br>
                    Diffusion: ‚àÇC/‚àÇt = K‚Çì‚àÇ¬≤C/‚àÇx¬≤ + K·µß‚àÇ¬≤C/‚àÇy¬≤ + K·µ§‚àÇ¬≤C/‚àÇz¬≤
                    <br><br>
                    Vertical mixing:<br>
                    K_vertical = K‚ÇÄ √ó (1 + Ri)‚Åª‚Åø
                    <br><br>
                    Where Ri = Richardson number
                </div>
                
                <div class="parameters">
                    <div class="param-group">
                        <label>u velocity (m/s)</label>
                        <input type="number" id="uVel" value="0.1" step="0.01">
                    </div>
                    <div class="param-group">
                        <label>v velocity (m/s)</label>
                        <input type="number" id="vVel" value="0.05" step="0.01">
                    </div>
                    <div class="param-group">
                        <label>K‚ÇÄ (m¬≤/s)</label>
                        <input type="number" id="k0" value="0.001" step="0.0001">
                    </div>
                    <div class="param-group">
                        <label>Richardson No.</label>
                        <input type="number" id="richardson" value="0.25" step="0.01">
                    </div>
                </div>
                
                <button class="calculate-btn" onclick="calculateTransport()">Calculate Transport</button>
                <div id="transportResults" class="results" style="display:none;"></div>
            </div>
        </div>

        <div class="depth-profile">
            <h3>üìä Depth Profile Visualization</h3>
            <div class="chart-container">
                <canvas id="depthChart" width="400" height="300"></canvas>
            </div>
            <button class="calculate-btn" onclick="generateDepthProfile()">Generate Depth Profiles</button>
        </div>
    </div>

    <script>
        let depthChart;

        function calculatePrimaryProduction() {
            const pmax = parseFloat(document.getElementById('pmax').value);
            const ik = parseFloat(document.getElementById('ik').value);
            const surfaceLight = parseFloat(document.getElementById('surfaceLight').value);
            const nitrate = parseFloat(document.getElementById('nitrate').value);
            const temp = parseFloat(document.getElementById('temperature').value);
            const lightAtten = parseFloat(document.getElementById('lightAtten').value);
            
            // Calculate light at different depths
            const depths = [0, 10, 20, 30, 50, 75, 100];
            let results = [];
            
            depths.forEach(depth => {
                const lightAtDepth = surfaceLight * Math.exp(-lightAtten * depth);
                const lightLimitation = (lightAtDepth / ik) * Math.exp(1 - lightAtDepth / ik);
                const tempFunction = Math.exp(0.063 * (temp - 20));
                const nutrientLimitation = nitrate / (nitrate + 1.0); // Half-saturation = 1.0 ŒºM
                
                const pp = pmax * lightLimitation * tempFunction * nutrientLimitation;
                results.push({depth, pp: pp.toFixed(2), light: lightAtDepth.toFixed(1)});
            });
            
            const totalPP = results.reduce((sum, r) => sum + parseFloat(r.pp), 0);
            
            document.getElementById('ppResults').innerHTML = `
                <h4>Primary Production Results:</h4>
                <p><strong>Total Water Column PP:</strong> ${totalPP.toFixed(2)} mg C m‚Åª¬≤ h‚Åª¬π</p>
                <p><strong>Euphotic Zone Depth:</strong> ${(4.6 / lightAtten).toFixed(1)} m</p>
                <div style="max-height: 150px; overflow-y: auto;">
                    ${results.map(r => `<p>${r.depth}m: ${r.pp} mg C m‚Åª¬≥ h‚Åª¬π (Light: ${r.light} Œºmol m‚Åª¬≤ s‚Åª¬π)</p>`).join('')}
                </div>
            `;
            document.getElementById('ppResults').style.display = 'block';
        }

        function calculateRespiration() {
            const r0 = parseFloat(document.getElementById('r0').value);
            const q10 = parseFloat(document.getElementById('q10').value);
            const doc = parseFloat(document.getElementById('doc').value);
            const kDecomp = parseFloat(document.getElementById('kDecomp').value);
            const temp = parseFloat(document.getElementById('temperature').value);
            
            const tempFunction = Math.pow(q10, (temp - 20) / 10);
            const respiration = r0 * tempFunction * doc;
            const decomposition = kDecomp * doc * tempFunction;
            
            document.getElementById('respResults').innerHTML = `
                <h4>Respiration & Decomposition Results:</h4>
                <p><strong>Respiration Rate:</strong> ${respiration.toFixed(3)} mg C m‚Åª¬≥ h‚Åª¬π</p>
                <p><strong>DOC Decomposition:</strong> ${decomposition.toFixed(3)} mg C L‚Åª¬π day‚Åª¬π</p>
                <p><strong>Temperature Factor:</strong> ${tempFunction.toFixed(2)}</p>
                <p><strong>Net Carbon Balance:</strong> ${(respiration - decomposition).toFixed(3)} mg C m‚Åª¬≥ h‚Åª¬π</p>
            `;
            document.getElementById('respResults').style.display = 'block';
        }

        function calculateNitrogen() {
            const nh4 = parseFloat(document.getElementById('nh4').value);
            const no3 = parseFloat(document.getElementById('no3').value);
            const o2 = parseFloat(document.getElementById('o2').value);
            const kNit = parseFloat(document.getElementById('kNit').value);
            const temp = parseFloat(document.getElementById('temperature').value);
            
            const tempFunction = Math.exp(0.069 * (temp - 20));
            const nitrification = kNit * nh4 * (o2 / (o2 + 20)) * tempFunction;
            const denitrification = 0.1 * no3 * Math.exp(-o2 / 50) * tempFunction;
            const nFixation = 0.05 * tempFunction * (no3 < 5 ? 1 : 0.1);
            
            document.getElementById('nResults').innerHTML = `
                <h4>Nitrogen Cycling Results:</h4>
                <p><strong>Nitrification Rate:</strong> ${nitrification.toFixed(3)} ŒºM day‚Åª¬π</p>
                <p><strong>Denitrification Rate:</strong> ${denitrification.toFixed(3)} ŒºM day‚Åª¬π</p>
                <p><strong>N‚ÇÇ Fixation Rate:</strong> ${nFixation.toFixed(3)} ŒºM day‚Åª¬π</p>
                <p><strong>Net N Transformation:</strong> ${(nitrification - denitrification + nFixation).toFixed(3)} ŒºM day‚Åª¬π</p>
            `;
            document.getElementById('nResults').style.display = 'block';
        }

        function calculateCarbon() {
            const dic = parseFloat(document.getElementById('dic').value);
            const alk = parseFloat(document.getElementById('alk').value);
            const pco2Air = parseFloat(document.getElementById('pco2Air').value);
            const windSpeed = parseFloat(document.getElementById('windSpeed').value);
            const temp = parseFloat(document.getElementById('temperature').value);
            const salinity = parseFloat(document.getElementById('salinity').value);
            
            // Simplified carbonate system calculations
            const k1 = 1.4e-6; // First dissociation constant (simplified)
            const k2 = 1.2e-9; // Second dissociation constant (simplified)
            const kw = 1e-14;  // Water dissociation constant
            const h = Math.pow(10, -parseFloat(document.getElementById('ph').value));
            
            // Calculate species concentrations (simplified)
            const co2 = dic / (1 + k1/h + k1*k2/(h*h));
            const hco3 = co2 * k1 / h;
            const co3 = hco3 * k2 / h;
            
            // Calculate pCO2 in seawater (simplified)
            const k0 = 0.034 * Math.exp(-0.014 * temp); // Solubility
            const pco2Sea = co2 / k0;
            
            // Air-sea CO2 flux
            const kGas = 0.31 * windSpeed * windSpeed * Math.sqrt(660/400); // Gas transfer velocity
            const flux = kGas * k0 * (pco2Air - pco2Sea);
            
            document.getElementById('carbonResults').innerHTML = `
                <h4>Carbon System Results:</h4>
                <p><strong>CO‚ÇÇ:</strong> ${co2.toFixed(1)} Œºmol kg‚Åª¬π</p>
                <p><strong>HCO‚ÇÉ‚Åª:</strong> ${hco3.toFixed(1)} Œºmol kg‚Åª¬π</p>
                <p><strong>CO‚ÇÉ¬≤‚Åª:</strong> ${co3.toFixed(1)} Œºmol kg‚Åª¬π</p>
                <p><strong>pCO‚ÇÇ seawater:</strong> ${pco2Sea.toFixed(1)} Œºatm</p>
                <p><strong>Air-Sea CO‚ÇÇ flux:</strong> ${flux.toFixed(3)} mmol m‚Åª¬≤ day‚Åª¬π</p>
                <p><strong>Saturation State:</strong> ${(co3 * 40 / 66.8).toFixed(2)} (Œ©_aragonite)</p>
            `;
            document.getElementById('carbonResults').style.display = 'block';
        }

        function calculateRedox() {
            const so4 = parseFloat(document.getElementById('so4').value);
            const fe2 = parseFloat(document.getElementById('fe2').value);
            const h2s = parseFloat(document.getElementById('h2s').value);
            const kRedox = parseFloat(document.getElementById('kRedox').value);
            const temp = parseFloat(document.getElementById('temperature').value);
            const o2 = parseFloat(document.getElementById('o2').value);
            
            const tempFunction = Math.exp(0.069 * (temp - 20));
            const o2Function = Math.exp(-o2 / 100); // Anaerobic processes
            
            const sulfateReduction = kRedox * so4 * o2Function * tempFunction;
            const ironOxidation = 0.5 * fe2 * (o2 / (o2 + 10)) * tempFunction;
            const sulfideOxidation = 2.0 * h2s * (o2 / (o2 + 5)) * tempFunction;
            
            document.getElementById('redoxResults').innerHTML = `
                <h4>Redox Process Results:</h4>
                <p><strong>Sulfate Reduction:</strong> ${sulfateReduction.toFixed(3)} mM day‚Åª¬π</p>
                <p><strong>Iron Oxidation:</strong> ${ironOxidation.toFixed(3)} ŒºM day‚Åª¬π</p>
                <p><strong>Sulfide Oxidation:</strong> ${sulfideOxidation.toFixed(3)} ŒºM day‚Åª¬π</p>
                <p><strong>Redox Potential:</strong> ${(400 - 59 * Math.log10(fe2 + 0.001)).toFixed(0)} mV</p>
            `;
            document.getElementById('redoxResults').style.display = 'block';
        }

        function calculateTransport() {
            const uVel = parseFloat(document.getElementById('uVel').value);
            const vVel = parseFloat(document.getElementById('vVel').value);
            const k0 = parseFloat(document.getElementById('k0').value);
            const richardson = parseFloat(document.getElementById('richardson').value);
            
            const horizontalVel = Math.sqrt(uVel * uVel + vVel * vVel);
            const verticalMixing = k0 * Math.pow(1 + richardson, -1);
            const reynoldsNumber = horizontalVel * 100 / 1e-6; // Assuming 100m length scale
            const pecletNumber = horizontalVel * 100 / (k0 * 1000); // Horizontal Peclet number
            
            document.getElementById('transportResults').innerHTML = `
                <h4>Physical Transport Results:</h4>
                <p><strong>Horizontal Velocity:</strong> ${horizontalVel.toFixed(3)} m/s</p>
                <p><strong>Vertical Mixing Coeff:</strong> ${(verticalMixing * 1000).toFixed(3)} mm¬≤/s</p>
                <p><strong>Reynolds Number:</strong> ${reynoldsNumber.toExponential(2)}</p>
                <p><strong>Peclet Number:</strong> ${pecletNumber.toFixed(1)}</p>
                <p><strong>Mixing Regime:</strong> ${richardson < 0.25 ? 'Turbulent' : 'Stratified'}</p>
            `;
            document.getElementById('transportResults').style.display = 'block';
        }

        function generateDepthProfile() {
            const ctx = document.getElementById('depthChart').getContext('2d');
            
            // Generate depth profile data
            const depths = [];
            const temperature = [];
            const oxygen = [];
            const nitrate = [];
            const chlorophyll = [];
            
            const surfaceTemp = parseFloat(document.getElementById('temperature').value);
            const mixedLayerDepth = parseFloat(document.getElementById('mixedLayer').value);
            
            for (let d = 0; d <= 100; d += 5) {
                depths.push(-d); // Negative for depth
                
                // Temperature profile
                if (d <= mixedLayerDepth) {
                    temperature.push(surfaceTemp);
                } else {
                    temperature.push(surfaceTemp - (d - mixedLayerDepth) * 0.1);
                }
                
                // Oxygen profile
                const oxygenSat = 300 - d * 1.5;
                oxygen.push(Math.max(50, oxygenSat));
                
                // Nitrate profile
                const nitrateConc = 2 + d * 0.15;
                nitrate.push(nitrateConc);
                
                // Chlorophyll profile (subsurface maximum)
                const chlMax = Math.exp(-Math.pow((d - 30) / 20, 2)) * 2.5;
                chlorophyll.push(chlMax);
            }
            
            if (depthChart) {
                depthChart.destroy();
            }
            
            depthChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: depths,
                    datasets: [{
                        label: 'Temperature (¬∞C)',
                        data: temperature,
                        borderColor: 'rgb(255, 99, 132)',
                        backgroundColor: 'rgba(255, 99, 132, 0.1)',
                        yAxisID: 'y'
                    }, {
                        label: 'Oxygen (ŒºM)',
                        data: oxygen,
                        borderColor: 'rgb(54, 162, 235)',
                        backgroundColor: 'rgba(54, 162, 235, 0.1)',
                        yAxisID: 'y1'
                    }, {
                        label: 'Nitrate (ŒºM)',
                        data: nitrate,
                        borderColor: 'rgb(75, 192, 192)',
                        backgroundColor: 'rgba(75, 192, 192, 0.1)',
                        yAxisID: 'y1'
                    }, {
                        label: 'Chlorophyll (mg/m¬≥)',
                        data: chlorophyll,
                        borderColor: 'rgb(153, 102, 255)',
                        backgroundColor: 'rgba(153, 102, 255, 0.1)',
                        yAxisID: 'y2'
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Depth (m)'
                            },
                            reverse: true
                        },
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'Temperature (¬∞C)'
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'Concentration (ŒºM)'
                            },
                            grid: {
                                drawOnChartArea: false,
                            },
                        },
                        y2: {
                            type: 'linear',
                            display: false,
                            position: 'right'
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'Coastal Ocean Biogeochemical Profiles (0-100m)'
                        }
                    }
                }
            });
        }

        // Initialize with default depth profile
        window.onload = function() {
            generateDepthProfile();
        };
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96c8d0dd860b88ac',t:'MTc1NDc1ODg5MS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Time Series Analysis Tool</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.11.0/math.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50, #3498db);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 300;
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .input-section {
            padding: 30px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }
        
        .input-grid {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 30px;
            margin-bottom: 20px;
        }
        
        .data-input {
            display: flex;
            flex-direction: column;
        }
        
        .data-input label {
            font-weight: 600;
            margin-bottom: 10px;
            color: #2c3e50;
        }
        
        .data-textarea {
            width: 100%;
            height: 200px;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            resize: vertical;
            transition: border-color 0.3s;
        }
        
        .data-textarea:focus {
            outline: none;
            border-color: #3498db;
        }
        
        .config-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .config-group {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #e9ecef;
        }
        
        .config-group h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #495057;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .analyze-btn {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            width: 100%;
        }
        
        .analyze-btn:hover {
            transform: translateY(-2px);
        }
        
        .results-section {
            padding: 30px;
            display: none;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border-left: 4px solid #3498db;
        }
        
        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #6c757d;
            font-size: 0.9rem;
        }
        
        .plot-container {
            margin-bottom: 30px;
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .plot-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .filter-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .filter-group {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }
        
        .filter-group h4 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        @media (max-width: 768px) {
            .input-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä Time Series Analysis Tool</h1>
            <p>Advanced statistical analysis and filtering for your time series data by Claudio Iturra</p>
        </div>
        
        <div class="input-section">
            <div class="input-grid">
                <div class="data-input">
                    <label for="dataInput">üìã Paste your time series data (one value per line):</label>
                    <textarea id="dataInput" class="data-textarea" placeholder="Example:
12.5
13.2
11.8
14.1
12.9
..."></textarea>
                </div>
                
                <div class="config-panel">
                    <div class="config-group">
                        <h3>‚è±Ô∏è Time Configuration</h3>
                        <div class="form-group">
                            <label for="startDate">Start Date & Time:</label>
                            <input type="datetime-local" id="startDate" value="2024-01-01T00:00">
                        </div>
                        <div class="form-group">
                            <label for="timeResolution">Time Resolution:</label>
                            <select id="timeResolution">
                                <option value="1">1 minute</option>
                                <option value="5">5 minutes</option>
                                <option value="15">15 minutes</option>
                                <option value="30">30 minutes</option>
                                <option value="60" selected>1 hour</option>
                                <option value="360">6 hours</option>
                                <option value="720">12 hours</option>
                                <option value="1440">1 day</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="variableName">Variable Name:</label>
                            <input type="text" id="variableName" value="Value" placeholder="e.g., Temperature, Pressure">
                        </div>
                    </div>
                    
                    <button class="analyze-btn" onclick="analyzeData()">
                        üîç Analyze Time Series
                    </button>
                </div>
            </div>
        </div>
        
        <div class="results-section" id="resultsSection">
            <div class="stats-grid" id="statsGrid"></div>
            
            <div class="filter-controls">
                <div class="filter-group">
                    <h4>üîΩ Low Pass Filter</h4>
                    <div class="form-group">
                        <label>Cutoff Frequency (cycles/day):</label>
                        <input type="number" id="lowPassCutoff" value="0.1" step="0.01" min="0.001">
                    </div>
                </div>
                <div class="filter-group">
                    <h4>üîº High Pass Filter</h4>
                    <div class="form-group">
                        <label>Cutoff Frequency (cycles/day):</label>
                        <input type="number" id="highPassCutoff" value="2" step="0.01" min="0.001">
                    </div>
                </div>
                <div class="filter-group">
                    <h4>üìä Band Pass Filter</h4>
                    <div class="form-group">
                        <label>Low Cutoff (cycles/day):</label>
                        <input type="number" id="bandPassLow" value="0.5" step="0.01" min="0.001">
                    </div>
                    <div class="form-group">
                        <label>High Cutoff (cycles/day):</label>
                        <input type="number" id="bandPassHigh" value="1.5" step="0.01" min="0.001">
                    </div>
                </div>
            </div>
            
            <div class="plot-container">
                <div class="plot-title">üìà Original Time Series</div>
                <div id="originalPlot"></div>
            </div>
            
            <div class="plot-container">
                <div class="plot-title">üîΩ Low Pass Filtered Signal</div>
                <div id="lowPassPlot"></div>
            </div>
            
            <div class="plot-container">
                <div class="plot-title">üîº High Pass Filtered Signal</div>
                <div id="highPassPlot"></div>
            </div>
            
            <div class="plot-container">
                <div class="plot-title">üìä Band Pass Filtered Signal</div>
                <div id="bandPassPlot"></div>
            </div>
            
            <div class="plot-container">
                <div class="plot-title">üìä Frequency Spectrum</div>
                <div id="spectrumPlot"></div>
            </div>
            
            <div class="plot-container">
                <div class="plot-title">üìà Statistical Summary</div>
                <div id="summaryPlot"></div>
            </div>
        </div>
    </div>

    <script>
        let timeSeriesData = [];
        let timeAxis = [];
        let variableName = 'Value';

        function analyzeData() {
            const dataText = document.getElementById('dataInput').value.trim();
            const startDate = new Date(document.getElementById('startDate').value);
            const resolution = parseInt(document.getElementById('timeResolution').value);
            variableName = document.getElementById('variableName').value || 'Value';
            
            if (!dataText) {
                alert('Please paste your time series data first!');
                return;
            }
            
            // Parse data
            const lines = dataText.split('\n').filter(line => line.trim());
            timeSeriesData = lines.map(line => parseFloat(line.trim())).filter(val => !isNaN(val));
            
            if (timeSeriesData.length === 0) {
                alert('No valid numeric data found. Please check your input.');
                return;
            }
            
            // Generate time axis
            timeAxis = [];
            for (let i = 0; i < timeSeriesData.length; i++) {
                const time = new Date(startDate.getTime() + i * resolution * 60000);
                timeAxis.push(time);
            }
            
            // Show results section
            document.getElementById('resultsSection').style.display = 'block';
            
            // Calculate statistics
            calculateStatistics();
            
            // Create plots
            plotOriginalData();
            applyFilters();
            plotSpectrum();
            plotSummary();
            
            // Scroll to results
            document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth' });
        }
        
        function calculateStatistics() {
            const data = timeSeriesData;
            const n = data.length;
            
            const mean = data.reduce((a, b) => a + b, 0) / n;
            const variance = data.reduce((a, b) => a + Math.pow(b - mean, 2), 0) / (n - 1);
            const std = Math.sqrt(variance);
            const min = Math.min(...data);
            const max = Math.max(...data);
            const range = max - min;
            
            // Median
            const sorted = [...data].sort((a, b) => a - b);
            const median = n % 2 === 0 ? 
                (sorted[n/2 - 1] + sorted[n/2]) / 2 : 
                sorted[Math.floor(n/2)];
            
            // Skewness
            const skewness = data.reduce((a, b) => a + Math.pow((b - mean) / std, 3), 0) / n;
            
            // Kurtosis
            const kurtosis = data.reduce((a, b) => a + Math.pow((b - mean) / std, 4), 0) / n - 3;
            
            const stats = [
                { label: 'Count', value: n.toLocaleString() },
                { label: 'Mean', value: mean.toFixed(3) },
                { label: 'Std Dev', value: std.toFixed(3) },
                { label: 'Min', value: min.toFixed(3) },
                { label: 'Max', value: max.toFixed(3) },
                { label: 'Range', value: range.toFixed(3) },
                { label: 'Median', value: median.toFixed(3) },
                { label: 'Skewness', value: skewness.toFixed(3) },
                { label: 'Kurtosis', value: kurtosis.toFixed(3) }
            ];
            
            const statsGrid = document.getElementById('statsGrid');
            statsGrid.innerHTML = stats.map(stat => `
                <div class="stat-card">
                    <div class="stat-value">${stat.value}</div>
                    <div class="stat-label">${stat.label}</div>
                </div>
            `).join('');
        }
        
        function plotOriginalData() {
            const trace = {
                x: timeAxis,
                y: timeSeriesData,
                type: 'scatter',
                mode: 'lines',
                name: variableName,
                line: { color: '#3498db', width: 2 }
            };
            
            const layout = {
                xaxis: { title: 'Time (Days)', type: 'date' },
                yaxis: { title: variableName },
                margin: { t: 30, r: 30, b: 60, l: 60 },
                showlegend: false,
                plot_bgcolor: '#f8f9fa',
                paper_bgcolor: 'white'
            };
            
            Plotly.newPlot('originalPlot', [trace], layout, {responsive: true});
        }
        
        function applyFilters() {
            const lowPassCutoff = parseFloat(document.getElementById('lowPassCutoff').value);
            const highPassCutoff = parseFloat(document.getElementById('highPassCutoff').value);
            const bandPassLow = parseFloat(document.getElementById('bandPassLow').value);
            const bandPassHigh = parseFloat(document.getElementById('bandPassHigh').value);
            
            // Simple moving average for low pass (approximation)
            const lowPassData = applyLowPassFilter(timeSeriesData, lowPassCutoff);
            const highPassData = applyHighPassFilter(timeSeriesData, highPassCutoff);
            const bandPassData = applyBandPassFilter(timeSeriesData, bandPassLow, bandPassHigh);
            
            plotFilteredData('lowPassPlot', lowPassData, 'Low Pass Filtered', '#e74c3c');
            plotFilteredData('highPassPlot', highPassData, 'High Pass Filtered', '#f39c12');
            plotFilteredData('bandPassPlot', bandPassData, 'Band Pass Filtered', '#9b59b6');
        }
        
        function applyLowPassFilter(data, cutoff) {
            // Simple moving average approximation
            const windowSize = Math.max(1, Math.floor(1 / cutoff));
            const filtered = [];
            
            for (let i = 0; i < data.length; i++) {
                let sum = 0;
                let count = 0;
                const start = Math.max(0, i - Math.floor(windowSize / 2));
                const end = Math.min(data.length - 1, i + Math.floor(windowSize / 2));
                
                for (let j = start; j <= end; j++) {
                    sum += data[j];
                    count++;
                }
                filtered.push(sum / count);
            }
            return filtered;
        }
        
        function applyHighPassFilter(data, cutoff) {
            const lowPass = applyLowPassFilter(data, cutoff);
            return data.map((val, i) => val - lowPass[i]);
        }
        
        function applyBandPassFilter(data, lowCutoff, highCutoff) {
            const lowPass = applyLowPassFilter(data, highCutoff);
            return applyHighPassFilter(lowPass, lowCutoff);
        }
        
        function plotFilteredData(plotId, data, name, color) {
            const trace = {
                x: timeAxis,
                y: data,
                type: 'scatter',
                mode: 'lines',
                name: name,
                line: { color: color, width: 2 }
            };
            
            const layout = {
                xaxis: { title: 'Time (Days)', type: 'date' },
                yaxis: { title: variableName },
                margin: { t: 30, r: 30, b: 60, l: 60 },
                showlegend: false,
                plot_bgcolor: '#f8f9fa',
                paper_bgcolor: 'white'
            };
            
            Plotly.newPlot(plotId, [trace], layout, {responsive: true});
        }
        
        function plotSpectrum() {
            // Simple frequency analysis (approximation)
            const n = timeSeriesData.length;
            const frequencies = [];
            const magnitudes = [];
            
            // Calculate basic frequency components
            for (let k = 1; k < n / 2; k++) {
                const freq = k / n;
                let real = 0, imag = 0;
                
                for (let i = 0; i < n; i++) {
                    const angle = -2 * Math.PI * k * i / n;
                    real += timeSeriesData[i] * Math.cos(angle);
                    imag += timeSeriesData[i] * Math.sin(angle);
                }
                
                frequencies.push(freq * 24); // Convert to cycles per day
                magnitudes.push(Math.sqrt(real * real + imag * imag) / n);
            }
            
            const trace = {
                x: frequencies.slice(0, 50), // Show first 50 frequencies
                y: magnitudes.slice(0, 50),
                type: 'scatter',
                mode: 'lines',
                name: 'Magnitude',
                line: { color: '#2ecc71', width: 2 }
            };
            
            const layout = {
                xaxis: { title: 'Frequency (cycles/day)' },
                yaxis: { title: 'Magnitude' },
                margin: { t: 30, r: 30, b: 60, l: 60 },
                showlegend: false,
                plot_bgcolor: '#f8f9fa',
                paper_bgcolor: 'white'
            };
            
            Plotly.newPlot('spectrumPlot', [trace], layout, {responsive: true});
        }
        
        function plotSummary() {
            // Box plot and histogram
            const trace1 = {
                y: timeSeriesData,
                type: 'box',
                name: 'Distribution',
                boxpoints: 'outliers',
                marker: { color: '#3498db' }
            };
            
            const trace2 = {
                x: timeSeriesData,
                type: 'histogram',
                name: 'Histogram',
                nbinsx: 30,
                marker: { color: '#e74c3c', opacity: 0.7 },
                yaxis: 'y2'
            };
            
            const layout = {
                grid: { rows: 1, columns: 2, pattern: 'independent' },
                xaxis: { title: variableName, domain: [0, 0.45] },
                xaxis2: { title: variableName, domain: [0.55, 1] },
                yaxis: { title: 'Value' },
                yaxis2: { title: 'Frequency', anchor: 'x2' },
                margin: { t: 30, r: 30, b: 60, l: 60 },
                showlegend: false,
                plot_bgcolor: '#f8f9fa',
                paper_bgcolor: 'white'
            };
            
            Plotly.newPlot('summaryPlot', [trace1, trace2], layout, {responsive: true});
        }
        
        // Update filters when values change
        document.getElementById('lowPassCutoff').addEventListener('input', applyFilters);
        document.getElementById('highPassCutoff').addEventListener('input', applyFilters);
        document.getElementById('bandPassLow').addEventListener('input', applyFilters);
        document.getElementById('bandPassHigh').addEventListener('input', applyFilters);
        
        // Sample data for demonstration
        document.getElementById('dataInput').value = `12.5
13.2
11.8
14.1
12.9
15.3
13.7
12.1
14.8
13.4
11.9
15.1
14.2
12.8
13.6
15.4
12.3
14.7
13.1
12.6
15.8
14.3
13.9
12.4
14.9
13.5
12.2
15.6
14.1
13.3
12.7
15.2
14.6
13.8
12.9
15.7
14.4
13.2
12.8
15.3`;
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'973dbe51a53288ab',t:'MTc1NTk4NDk2NS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>

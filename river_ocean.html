<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coastal River-Ocean Interaction Model</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #64b5f6, #81c784);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .control-panel {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        
        .control-group {
            margin-bottom: 15px;
        }
        
        .control-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #e3f2fd;
        }
        
        .control-group input, .control-group select {
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 14px;
        }
        
        .control-group input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }
        
        .results {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .result-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        
        .result-card h3 {
            color: #81c784;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }
        
        .parameter {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 5px;
        }
        
        .parameter-name {
            font-weight: 500;
        }
        
        .parameter-value {
            color: #64b5f6;
            font-weight: 600;
        }
        
        .equation {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            border-left: 4px solid #81c784;
        }
        
        .charts {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 20px;
        }
        
        .chart-container {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            height: 400px;
        }
        
        .update-btn {
            background: linear-gradient(45deg, #4caf50, #45a049);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px 0;
            width: 100%;
        }
        
        .update-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
        }
        
        .warning {
            background: rgba(255, 152, 0, 0.2);
            border: 1px solid #ff9800;
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üåä Coastal River-Ocean Interaction Model</h1>
            <p>Comprehensive evaluation of freshwater intrusion impacts on coastal marine systems by Claudio Iturra</p>
        </div>
        
        <div class="controls">
            <div class="control-panel">
                <h3>üèûÔ∏è River Parameters</h3>
                <div class="control-group">
                    <label>River Discharge (m¬≥/s)</label>
                    <input type="number" id="riverDischarge" value="1500" min="0" max="10000">
                </div>
                <div class="control-group">
                    <label>River Temperature (¬∞C)</label>
                    <input type="number" id="riverTemp" value="18" min="0" max="35">
                </div>
                <div class="control-group">
                    <label>Sediment Load (mg/L)</label>
                    <input type="number" id="sedimentLoad" value="250" min="0" max="1000">
                </div>
                <div class="control-group">
                    <label>Nitrate Concentration (ŒºM)</label>
                    <input type="number" id="nitrateConc" value="45" min="0" max="200">
                </div>
            </div>
            
            <div class="control-panel">
                <h3>üåä Ocean Parameters</h3>
                <div class="control-group">
                    <label>Ocean Temperature (¬∞C)</label>
                    <input type="number" id="oceanTemp" value="22" min="0" max="35">
                </div>
                <div class="control-group">
                    <label>Ocean Salinity (PSU)</label>
                    <input type="number" id="oceanSalinity" value="35" min="20" max="40">
                </div>
                <div class="control-group">
                    <label>Ocean Depth (m)</label>
                    <input type="number" id="oceanDepth" value="50" min="10" max="200">
                </div>
                <div class="control-group">
                    <label>Background Oxygen (mg/L)</label>
                    <input type="number" id="backgroundO2" value="8.5" min="0" max="15">
                </div>
            </div>
            
            <div class="control-panel">
                <h3>üå¨Ô∏è Environmental Conditions</h3>
                <div class="control-group">
                    <label>Wind Speed (m/s)</label>
                    <input type="number" id="windSpeed" value="8" min="0" max="25">
                </div>
                <div class="control-group">
                    <label>Tidal Range (m)</label>
                    <input type="number" id="tidalRange" value="2.5" min="0" max="10">
                </div>
                <div class="control-group">
                    <label>Season</label>
                    <select id="season">
                        <option value="spring">Spring</option>
                        <option value="summer">Summer</option>
                        <option value="autumn">Autumn</option>
                        <option value="winter">Winter</option>
                    </select>
                </div>
                <button class="update-btn" onclick="calculateAll()">üîÑ Update Model</button>
            </div>
        </div>
        
        <div class="results">
            <div class="result-card">
                <h3>üå°Ô∏è Thermal Front Analysis</h3>
                <div class="equation">
                    ŒîT = T_ocean - T_river<br>
                    Thermal Front Strength = ŒîT √ó (œÅ_ocean - œÅ_river) / œÅ_avg<br>
                    Mixed Layer Depth = 2.5 √ó u*¬≤ / (N¬≤ √ó f)
                </div>
                <div id="thermalResults"></div>
            </div>
            
            <div class="result-card">
                <h3>ü¶† Primary Productivity</h3>
                <div class="equation">
                    PP = P_max √ó (I/I_k) √ó exp(1 - I/I_k) √ó f(N)<br>
                    f(N) = [NO‚ÇÉ] / (K_s + [NO‚ÇÉ])<br>
                    Light Attenuation: I_z = I_0 √ó exp(-k √ó z)
                </div>
                <div id="productivityResults"></div>
            </div>
            
            <div class="result-card">
                <h3>üèîÔ∏è Sedimentation Dynamics</h3>
                <div class="equation">
                    Settling Velocity: w_s = (2gr¬≤(œÅ_s - œÅ_w)) / (9Œº)<br>
                    Deposition Rate = C √ó w_s √ó (1 - œÑ_b/œÑ_cr)<br>
                    Resuspension = M √ó (œÑ_b/œÑ_cr - 1)
                </div>
                <div id="sedimentResults"></div>
            </div>
            
            <div class="result-card">
                <h3>üí® Oxygen Dynamics</h3>
                <div class="equation">
                    dO‚ÇÇ/dt = k_a(O‚ÇÇ_sat - O‚ÇÇ) + PP - R - SOD<br>
                    O‚ÇÇ_sat = f(T, S, P)<br>
                    Reaeration: k_a = 0.31 √ó U‚ÇÅ‚ÇÄ^1.24 √ó Sc^(-0.5)
                </div>
                <div id="oxygenResults"></div>
            </div>
            
            <div class="result-card">
                <h3>üß™ Nutrient Cycling</h3>
                <div class="equation">
                    dN/dt = -Œº_max √ó N/(K_s + N) √ó B + R_N + D_N<br>
                    Mixing Coefficient: K_z = Œ∫u*z(1 - z/h)<br>
                    Advection: u‚àÇN/‚àÇx + v‚àÇN/‚àÇy + w‚àÇN/‚àÇz
                </div>
                <div id="nutrientResults"></div>
            </div>
            
            <div class="result-card">
                <h3>üåä Physical Mixing</h3>
                <div class="equation">
                    Richardson Number: Ri = N¬≤/(‚àÇu/‚àÇz)¬≤<br>
                    Stratification: N¬≤ = -(g/œÅ‚ÇÄ)(‚àÇœÅ/‚àÇz)<br>
                    Wind Mixed Layer: h_ml = 2.5u*/(f √ó N)
                </div>
                <div id="mixingResults"></div>
            </div>
        </div>
        
        <div class="charts">
            <div class="chart-container">
                <canvas id="salinityChart"></canvas>
            </div>
            <div class="chart-container">
                <canvas id="temperatureChart"></canvas>
            </div>
            <div class="chart-container">
                <canvas id="oxygenChart"></canvas>
            </div>
            <div class="chart-container">
                <canvas id="nutrientChart"></canvas>
            </div>
        </div>
    </div>

    <script>
        let charts = {};
        
        function calculateAll() {
            // Get input values
            const riverDischarge = parseFloat(document.getElementById('riverDischarge').value);
            const riverTemp = parseFloat(document.getElementById('riverTemp').value);
            const sedimentLoad = parseFloat(document.getElementById('sedimentLoad').value);
            const nitrateConc = parseFloat(document.getElementById('nitrateConc').value);
            const oceanTemp = parseFloat(document.getElementById('oceanTemp').value);
            const oceanSalinity = parseFloat(document.getElementById('oceanSalinity').value);
            const oceanDepth = parseFloat(document.getElementById('oceanDepth').value);
            const backgroundO2 = parseFloat(document.getElementById('backgroundO2').value);
            const windSpeed = parseFloat(document.getElementById('windSpeed').value);
            const tidalRange = parseFloat(document.getElementById('tidalRange').value);
            const season = document.getElementById('season').value;
            
            // Calculate thermal front parameters
            const thermalResults = calculateThermalFront(riverTemp, oceanTemp, riverDischarge, windSpeed, oceanDepth);
            
            // Calculate productivity
            const productivityResults = calculateProductivity(nitrateConc, sedimentLoad, riverDischarge, season);
            
            // Calculate sedimentation
            const sedimentResults = calculateSedimentation(sedimentLoad, riverDischarge, windSpeed, tidalRange);
            
            // Calculate oxygen dynamics
            const oxygenResults = calculateOxygen(backgroundO2, riverTemp, oceanTemp, productivityResults.primaryProduction, windSpeed);
            
            // Calculate nutrient dynamics
            const nutrientResults = calculateNutrients(nitrateConc, riverDischarge, productivityResults.primaryProduction, windSpeed);
            
            // Calculate mixing parameters
            const mixingResults = calculateMixing(windSpeed, riverTemp, oceanTemp, oceanSalinity, oceanDepth);
            
            // Update displays
            updateThermalDisplay(thermalResults);
            updateProductivityDisplay(productivityResults);
            updateSedimentDisplay(sedimentResults);
            updateOxygenDisplay(oxygenResults);
            updateNutrientDisplay(nutrientResults);
            updateMixingDisplay(mixingResults);
            
            // Update charts
            updateCharts(riverDischarge, oceanSalinity, riverTemp, oceanTemp, oxygenResults, nutrientResults);
        }
        
        function calculateThermalFront(riverTemp, oceanTemp, discharge, windSpeed, depth) {
            const tempDiff = oceanTemp - riverTemp;
            const riverDensity = 1000 - 0.2 * (riverTemp - 4); // Simplified density
            const oceanDensity = 1025 + 0.8 * (35 - 35) - 0.2 * (oceanTemp - 4);
            const densityDiff = oceanDensity - riverDensity;
            const avgDensity = (riverDensity + oceanDensity) / 2;
            
            const thermalFrontStrength = tempDiff * densityDiff / avgDensity;
            const frictionVelocity = 0.03 * windSpeed; // u*
            const coriolisParam = 1e-4; // f parameter
            const stratification = 9.81 * densityDiff / (avgDensity * depth); // N¬≤
            
            const mixedLayerDepth = Math.min(2.5 * Math.pow(frictionVelocity, 2) / (stratification * coriolisParam), depth);
            const plumeWidth = Math.sqrt(discharge / (0.1 * Math.sqrt(9.81 * densityDiff / avgDensity)));
            
            return {
                tempDiff: tempDiff.toFixed(2),
                frontStrength: thermalFrontStrength.toFixed(4),
                mixedLayerDepth: mixedLayerDepth.toFixed(1),
                plumeWidth: plumeWidth.toFixed(0),
                stratification: stratification.toFixed(6)
            };
        }
        
        function calculateProductivity(nitrate, sediment, discharge, season) {
            const seasonalFactor = {
                'spring': 1.2,
                'summer': 1.0,
                'autumn': 0.8,
                'winter': 0.6
            };
            
            const lightAttenuation = 0.1 + 0.01 * sediment; // k coefficient
            const maxDepth = 1.0 / lightAttenuation; // euphotic depth
            
            const nutrientLimitation = nitrate / (5 + nitrate); // Michaelis-Menten
            const maxProductivity = 2.5; // mg C/m¬≥/day
            
            const primaryProduction = maxProductivity * nutrientLimitation * seasonalFactor[season] * Math.exp(-lightAttenuation);
            const chlorophyllA = primaryProduction * 0.5; // Chl-a estimation
            const oxygenProduction = primaryProduction * 2.67; // O‚ÇÇ:C ratio
            
            return {
                primaryProduction: primaryProduction.toFixed(2),
                chlorophyllA: chlorophyllA.toFixed(2),
                oxygenProduction: oxygenProduction.toFixed(2),
                euphoticDepth: maxDepth.toFixed(1),
                nutrientLimitation: (nutrientLimitation * 100).toFixed(1)
            };
        }
        
        function calculateSedimentation(sedimentLoad, discharge, windSpeed, tidalRange) {
            const particleSize = 50e-6; // 50 Œºm
            const particleDensity = 2650; // kg/m¬≥
            const waterDensity = 1025;
            const viscosity = 1.36e-6; // m¬≤/s
            
            const settlingVelocity = (2 * 9.81 * Math.pow(particleSize, 2) * (particleDensity - waterDensity)) / (9 * viscosity * waterDensity);
            
            const shearStress = 0.003 * Math.pow(windSpeed, 2) + 0.1 * Math.pow(tidalRange, 2);
            const criticalShearStress = 0.1; // N/m¬≤
            
            const depositionRate = sedimentLoad * settlingVelocity * Math.max(0, 1 - shearStress / criticalShearStress);
            const resuspensionRate = Math.max(0, 0.01 * (shearStress / criticalShearStress - 1));
            
            const turbidity = sedimentLoad * (1 + 0.1 * windSpeed);
            const sedimentationRate = depositionRate - resuspensionRate;
            
            return {
                settlingVelocity: (settlingVelocity * 1000).toFixed(3), // mm/s
                depositionRate: depositionRate.toFixed(2),
                resuspensionRate: resuspensionRate.toFixed(3),
                netSedimentation: sedimentationRate.toFixed(2),
                turbidity: turbidity.toFixed(1)
            };
        }
        
        function calculateOxygen(backgroundO2, riverTemp, oceanTemp, primaryProduction, windSpeed) {
            const avgTemp = (riverTemp + oceanTemp) / 2;
            const oxygenSaturation = 14.6 - 0.41 * avgTemp + 0.008 * Math.pow(avgTemp, 2); // mg/L
            
            const reaeration = 0.31 * Math.pow(windSpeed, 1.24) * Math.pow(600, -0.5); // k_a
            const respiration = 0.5 * parseFloat(primaryProduction); // Simplified
            const sedimentOxygenDemand = 2.0; // g/m¬≤/day
            
            const oxygenChange = reaeration * (oxygenSaturation - backgroundO2) + parseFloat(primaryProduction) * 2.67 - respiration - sedimentOxygenDemand;
            const finalOxygen = Math.max(0, backgroundO2 + oxygenChange * 0.1);
            
            const oxygenSatPercent = (finalOxygen / oxygenSaturation) * 100;
            
            return {
                saturation: oxygenSaturation.toFixed(2),
                finalConcentration: finalOxygen.toFixed(2),
                saturationPercent: oxygenSatPercent.toFixed(1),
                reaeration: reaeration.toFixed(4),
                netChange: oxygenChange.toFixed(2)
            };
        }
        
        function calculateNutrients(nitrate, discharge, primaryProduction, windSpeed) {
            const uptakeRate = 0.1 * parseFloat(primaryProduction); // Nutrient uptake
            const regenerationRate = 0.05 * parseFloat(primaryProduction); // Remineralization
            const mixingCoeff = 0.01 * windSpeed * windSpeed; // Vertical mixing
            
            const nitrateChange = -uptakeRate + regenerationRate + mixingCoeff * (nitrate - 10);
            const finalNitrate = Math.max(0, nitrate + nitrateChange);
            
            const phosphate = nitrate / 16; // Redfield ratio
            const silicate = nitrate * 1.2; // Si:N ratio
            const ammonium = regenerationRate * 0.8;
            
            const nToP = finalNitrate / phosphate;
            const limitingNutrient = nToP < 16 ? 'Nitrogen' : 'Phosphorus';
            
            return {
                finalNitrate: finalNitrate.toFixed(2),
                phosphate: phosphate.toFixed(2),
                silicate: silicate.toFixed(2),
                ammonium: ammonium.toFixed(2),
                nToPRatio: nToP.toFixed(1),
                limitingNutrient: limitingNutrient
            };
        }
        
        function calculateMixing(windSpeed, riverTemp, oceanTemp, salinity, depth) {
            const tempGradient = (oceanTemp - riverTemp) / depth;
            const salinityGradient = salinity / depth; // Simplified
            const densityGradient = 0.2 * tempGradient + 0.8 * salinityGradient;
            
            const stratification = 9.81 * densityGradient / 1025; // N¬≤
            const shearRate = windSpeed / depth; // Simplified du/dz
            const richardsonNumber = stratification / Math.pow(shearRate, 2);
            
            const frictionVelocity = 0.03 * windSpeed;
            const coriolisParam = 1e-4;
            const windMixedLayer = 2.5 * frictionVelocity / (coriolisParam * Math.sqrt(Math.abs(stratification)));
            
            const mixingIntensity = richardsonNumber < 0.25 ? 'High' : richardsonNumber < 1 ? 'Moderate' : 'Low';
            
            return {
                richardsonNumber: richardsonNumber.toFixed(3),
                stratification: stratification.toFixed(6),
                windMixedLayer: Math.min(windMixedLayer, depth).toFixed(1),
                mixingIntensity: mixingIntensity,
                shearRate: shearRate.toFixed(4)
            };
        }
        
        function updateThermalDisplay(results) {
            document.getElementById('thermalResults').innerHTML = `
                <div class="parameter"><span class="parameter-name">Temperature Difference:</span><span class="parameter-value">${results.tempDiff} ¬∞C</span></div>
                <div class="parameter"><span class="parameter-name">Front Strength:</span><span class="parameter-value">${results.frontStrength}</span></div>
                <div class="parameter"><span class="parameter-name">Mixed Layer Depth:</span><span class="parameter-value">${results.mixedLayerDepth} m</span></div>
                <div class="parameter"><span class="parameter-name">Plume Width:</span><span class="parameter-value">${results.plumeWidth} m</span></div>
                <div class="parameter"><span class="parameter-name">Stratification (N¬≤):</span><span class="parameter-value">${results.stratification} s‚Åª¬≤</span></div>
            `;
        }
        
        function updateProductivityDisplay(results) {
            document.getElementById('productivityResults').innerHTML = `
                <div class="parameter"><span class="parameter-name">Primary Production:</span><span class="parameter-value">${results.primaryProduction} mg C/m¬≥/day</span></div>
                <div class="parameter"><span class="parameter-name">Chlorophyll-a:</span><span class="parameter-value">${results.chlorophyllA} Œºg/L</span></div>
                <div class="parameter"><span class="parameter-name">O‚ÇÇ Production:</span><span class="parameter-value">${results.oxygenProduction} mg/m¬≥/day</span></div>
                <div class="parameter"><span class="parameter-name">Euphotic Depth:</span><span class="parameter-value">${results.euphoticDepth} m</span></div>
                <div class="parameter"><span class="parameter-name">Nutrient Limitation:</span><span class="parameter-value">${results.nutrientLimitation}%</span></div>
            `;
        }
        
        function updateSedimentDisplay(results) {
            document.getElementById('sedimentResults').innerHTML = `
                <div class="parameter"><span class="parameter-name">Settling Velocity:</span><span class="parameter-value">${results.settlingVelocity} mm/s</span></div>
                <div class="parameter"><span class="parameter-name">Deposition Rate:</span><span class="parameter-value">${results.depositionRate} mg/L/day</span></div>
                <div class="parameter"><span class="parameter-name">Resuspension Rate:</span><span class="parameter-value">${results.resuspensionRate} mg/L/day</span></div>
                <div class="parameter"><span class="parameter-name">Net Sedimentation:</span><span class="parameter-value">${results.netSedimentation} mg/L/day</span></div>
                <div class="parameter"><span class="parameter-name">Turbidity:</span><span class="parameter-value">${results.turbidity} NTU</span></div>
            `;
        }
        
        function updateOxygenDisplay(results) {
            document.getElementById('oxygenResults').innerHTML = `
                <div class="parameter"><span class="parameter-name">O‚ÇÇ Saturation:</span><span class="parameter-value">${results.saturation} mg/L</span></div>
                <div class="parameter"><span class="parameter-name">Final O‚ÇÇ Concentration:</span><span class="parameter-value">${results.finalConcentration} mg/L</span></div>
                <div class="parameter"><span class="parameter-name">Saturation Percent:</span><span class="parameter-value">${results.saturationPercent}%</span></div>
                <div class="parameter"><span class="parameter-name">Reaeration Coefficient:</span><span class="parameter-value">${results.reaeration} day‚Åª¬π</span></div>
                <div class="parameter"><span class="parameter-name">Net O‚ÇÇ Change:</span><span class="parameter-value">${results.netChange} mg/L/day</span></div>
            `;
        }
        
        function updateNutrientDisplay(results) {
            document.getElementById('nutrientResults').innerHTML = `
                <div class="parameter"><span class="parameter-name">Final Nitrate:</span><span class="parameter-value">${results.finalNitrate} ŒºM</span></div>
                <div class="parameter"><span class="parameter-name">Phosphate:</span><span class="parameter-value">${results.phosphate} ŒºM</span></div>
                <div class="parameter"><span class="parameter-name">Silicate:</span><span class="parameter-value">${results.silicate} ŒºM</span></div>
                <div class="parameter"><span class="parameter-name">Ammonium:</span><span class="parameter-value">${results.ammonium} ŒºM</span></div>
                <div class="parameter"><span class="parameter-name">N:P Ratio:</span><span class="parameter-value">${results.nToPRatio}</span></div>
                <div class="parameter"><span class="parameter-name">Limiting Nutrient:</span><span class="parameter-value">${results.limitingNutrient}</span></div>
            `;
        }
        
        function updateMixingDisplay(results) {
            document.getElementById('mixingResults').innerHTML = `
                <div class="parameter"><span class="parameter-name">Richardson Number:</span><span class="parameter-value">${results.richardsonNumber}</span></div>
                <div class="parameter"><span class="parameter-name">Stratification (N¬≤):</span><span class="parameter-value">${results.stratification} s‚Åª¬≤</span></div>
                <div class="parameter"><span class="parameter-name">Wind Mixed Layer:</span><span class="parameter-value">${results.windMixedLayer} m</span></div>
                <div class="parameter"><span class="parameter-name">Mixing Intensity:</span><span class="parameter-value">${results.mixingIntensity}</span></div>
                <div class="parameter"><span class="parameter-name">Shear Rate:</span><span class="parameter-value">${results.shearRate} s‚Åª¬π</span></div>
            `;
        }
        
        function updateCharts(discharge, salinity, riverTemp, oceanTemp, oxygenResults, nutrientResults) {
            // Generate distance data (0-10 km from river mouth)
            const distances = Array.from({length: 21}, (_, i) => i * 0.5);
            
            // Salinity gradient
            const salinityData = distances.map(d => {
                const mixingFactor = Math.exp(-d / 3);
                return salinity * (1 - mixingFactor) + 0 * mixingFactor;
            });
            
            // Temperature gradient
            const tempData = distances.map(d => {
                const mixingFactor = Math.exp(-d / 2);
                return oceanTemp * (1 - mixingFactor) + riverTemp * mixingFactor;
            });
            
            // Oxygen gradient
            const oxygenData = distances.map(d => {
                const mixingFactor = Math.exp(-d / 2.5);
                return parseFloat(oxygenResults.finalConcentration) * (1 - mixingFactor) + 6 * mixingFactor;
            });
            
            // Nutrient gradient
            const nutrientData = distances.map(d => {
                const mixingFactor = Math.exp(-d / 3);
                return parseFloat(nutrientResults.finalNitrate) * mixingFactor + 10 * (1 - mixingFactor);
            });
            
            // Update or create charts
            updateChart('salinityChart', 'Salinity Distribution', distances, salinityData, 'PSU', '#2196F3');
            updateChart('temperatureChart', 'Temperature Distribution', distances, tempData, '¬∞C', '#FF5722');
            updateChart('oxygenChart', 'Dissolved Oxygen Distribution', distances, oxygenData, 'mg/L', '#4CAF50');
            updateChart('nutrientChart', 'Nitrate Distribution', distances, nutrientData, 'ŒºM', '#9C27B0');
        }
        
        function updateChart(canvasId, title, xData, yData, unit, color) {
            const ctx = document.getElementById(canvasId).getContext('2d');
            
            if (charts[canvasId]) {
                charts[canvasId].destroy();
            }
            
            charts[canvasId] = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: xData,
                    datasets: [{
                        label: `${title} (${unit})`,
                        data: yData,
                        borderColor: color,
                        backgroundColor: color + '20',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: title,
                            color: 'white',
                            font: { size: 16 }
                        },
                        legend: {
                            labels: { color: 'white' }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Distance from River Mouth (km)',
                                color: 'white'
                            },
                            ticks: { color: 'white' },
                            grid: { color: 'rgba(255,255,255,0.1)' }
                        },
                        y: {
                            title: {
                                display: true,
                                text: unit,
                                color: 'white'
                            },
                            ticks: { color: 'white' },
                            grid: { color: 'rgba(255,255,255,0.1)' }
                        }
                    }
                }
            });
        }
        
        // Initialize with default values
        calculateAll();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96cb238c40db88a6',t:'MTc1NDc4MzI0OS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>

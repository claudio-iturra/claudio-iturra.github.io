<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tidal Analysis & Evaluation System</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 15px;
            padding: 25px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .full-width {
            grid-column: 1 / -1;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #e0e7ff;
        }
        
        input, select {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            font-size: 14px;
            box-sizing: border-box;
        }
        
        button {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: transform 0.2s;
            width: 100%;
            margin-top: 10px;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .equation {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
            border-left: 4px solid #ff6b6b;
        }
        
        .results {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .result-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #4ecdc4;
        }
        
        .chart-container {
            position: relative;
            height: 400px;
            margin-top: 20px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            padding: 20px;
        }
        
        .tidal-components {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }
        
        .component {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 6px;
            text-align: center;
            font-size: 12px;
        }
        
        .toggle-group {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }
        
        .toggle-btn {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }
        
        .toggle-btn.active {
            background: #ff6b6b;
            border-color: #ff6b6b;
        }
        
        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
            .container {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üåä Tidal Analysis & Evaluation System</h1>
            <p>Comprehensive analysis of sea level fluctuations and horizontal tidal velocities by Claudio Iturra</p>
        </div>
        
        <div class="grid">
            <div class="card">
                <h3>üìç Location Parameters</h3>
                <div class="input-group">
                    <label>Latitude (degrees)</label>
                    <input type="number" id="latitude" value="45.0" step="0.1" min="-90" max="90">
                </div>
                <div class="input-group">
                    <label>Longitude (degrees)</label>
                    <input type="number" id="longitude" value="0.0" step="0.1" min="-180" max="180">
                </div>
                <div class="input-group">
                    <label>Water Depth (m)</label>
                    <input type="number" id="depth" value="100" step="1" min="1">
                </div>
            </div>
            
            <div class="card">
                <h3>‚è±Ô∏è Time Series Parameters</h3>
                <div class="input-group">
                    <label>Duration (days)</label>
                    <input type="number" id="duration" value="30" step="1" min="1" max="365">
                </div>
                <div class="input-group">
                    <label>Time Step (hours)</label>
                    <input type="number" id="timestep" value="1" step="0.1" min="0.1" max="24">
                </div>
                <div class="input-group">
                    <label>Analysis Type</label>
                    <select id="analysisType">
                        <option value="both">Barotropic + Baroclinic</option>
                        <option value="barotropic">Barotropic Only</option>
                        <option value="baroclinic">Baroclinic Only</option>
                    </select>
                </div>
                <button onclick="calculateTides()">üî¨ Calculate Tidal Analysis</button>
            </div>
        </div>
        
        <div class="card full-width">
            <h3>üìê Tidal Equations</h3>
            <div class="equation">
                <strong>Sea Level Elevation:</strong><br>
                Œ∑(t) = Œ£[A·µ¢ √ó cos(œâ·µ¢t + œÜ·µ¢)] + A‚ÇÄ
            </div>
            <div class="equation">
                <strong>Horizontal Velocity (Barotropic):</strong><br>
                u_bt = (g/f) √ó (‚àÇŒ∑/‚àÇy) = Œ£[A·µ¢ √ó (g√óœâ·µ¢/f) √ó sin(œâ·µ¢t + œÜ·µ¢)]
            </div>
            <div class="equation">
                <strong>Horizontal Velocity (Baroclinic):</strong><br>
                u_bc = (g'/f) √ó (‚àÇŒ∑'/‚àÇy) √ó sin(œÄz/H)
            </div>
            <div class="equation">
                <strong>Coriolis Parameter:</strong><br>
                f = 2Œ© sin(œÜ) = 1.458 √ó 10‚Åª‚Å¥ √ó sin(œÜ) [s‚Åª¬π]
            </div>
        </div>
        
        <div class="card full-width">
            <h3>üåä Major Tidal Components</h3>
            <div class="tidal-components" id="tidalComponents">
                <!-- Components will be populated by JavaScript -->
            </div>
        </div>
        
        <div class="card full-width">
            <h3>üìä Analysis Results</h3>
            <div class="toggle-group">
                <div class="toggle-btn active" onclick="showChart('elevation')">Sea Level</div>
                <div class="toggle-btn" onclick="showChart('velocity')">Velocity</div>
                <div class="toggle-btn" onclick="showChart('spectrum')">Frequency Spectrum</div>
            </div>
            <div class="chart-container">
                <canvas id="tidalChart"></canvas>
            </div>
            <div class="results" id="results">
                <!-- Results will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <script>
        // Tidal constituents with their properties
        const tidalConstituents = {
            'M2': { period: 12.42, amplitude: 1.0, phase: 0, description: 'Principal lunar semi-diurnal' },
            'S2': { period: 12.00, amplitude: 0.47, phase: 0, description: 'Principal solar semi-diurnal' },
            'N2': { period: 12.66, amplitude: 0.19, phase: 0, description: 'Lunar elliptic semi-diurnal' },
            'K2': { period: 11.97, amplitude: 0.13, phase: 0, description: 'Lunisolar semi-diurnal' },
            'K1': { period: 23.93, amplitude: 0.58, phase: 90, description: 'Lunisolar diurnal' },
            'O1': { period: 25.82, amplitude: 0.42, phase: 90, description: 'Lunar diurnal' },
            'P1': { period: 24.07, amplitude: 0.19, phase: 90, description: 'Solar diurnal' },
            'Q1': { period: 26.87, amplitude: 0.08, phase: 90, description: 'Lunar elliptic diurnal' },
            'Mf': { period: 327.86, amplitude: 0.17, phase: 0, description: 'Lunar fortnightly' },
            'Mm': { period: 661.31, amplitude: 0.09, phase: 0, description: 'Lunar monthly' }
        };
        
        let currentChart = null;
        let tidalData = null;
        
        function displayTidalComponents() {
            const container = document.getElementById('tidalComponents');
            container.innerHTML = '';
            
            Object.entries(tidalConstituents).forEach(([name, data]) => {
                const div = document.createElement('div');
                div.className = 'component';
                div.innerHTML = `
                    <strong>${name}</strong><br>
                    T: ${data.period.toFixed(2)}h<br>
                    A: ${data.amplitude.toFixed(2)}m<br>
                    <small>${data.description}</small>
                `;
                container.appendChild(div);
            });
        }
        
        function calculateTides() {
            const latitude = parseFloat(document.getElementById('latitude').value);
            const longitude = parseFloat(document.getElementById('longitude').value);
            const depth = parseFloat(document.getElementById('depth').value);
            const duration = parseInt(document.getElementById('duration').value);
            const timestep = parseFloat(document.getElementById('timestep').value);
            const analysisType = document.getElementById('analysisType').value;
            
            // Calculate Coriolis parameter
            const f = 1.458e-4 * Math.sin(latitude * Math.PI / 180);
            const g = 9.81; // gravity
            const g_prime = 0.02; // reduced gravity for baroclinic modes
            
            // Generate time series
            const hours = duration * 24;
            const timePoints = Math.floor(hours / timestep);
            const times = [];
            const elevations = [];
            const velocitiesBarotropic = [];
            const velocitiesBaroclinic = [];
            
            for (let i = 0; i < timePoints; i++) {
                const t = i * timestep;
                times.push(t);
                
                let elevation = 0;
                let velBt = 0;
                let velBc = 0;
                
                // Calculate tidal elevation and velocities
                Object.entries(tidalConstituents).forEach(([name, constituent]) => {
                    const omega = 2 * Math.PI / constituent.period;
                    const phase = constituent.phase * Math.PI / 180;
                    
                    // Adjust amplitude based on latitude (simplified)
                    const latFactor = Math.cos(latitude * Math.PI / 180);
                    const amplitude = constituent.amplitude * latFactor;
                    
                    // Sea level elevation
                    elevation += amplitude * Math.cos(omega * t + phase);
                    
                    // Barotropic velocity
                    if (analysisType === 'barotropic' || analysisType === 'both') {
                        velBt += amplitude * (g * omega / Math.abs(f)) * Math.sin(omega * t + phase) * 0.01;
                    }
                    
                    // Baroclinic velocity (simplified)
                    if (analysisType === 'baroclinic' || analysisType === 'both') {
                        const depthFactor = Math.sin(Math.PI * depth / (2 * depth));
                        velBc += amplitude * (g_prime * omega / Math.abs(f)) * Math.sin(omega * t + phase) * depthFactor * 0.005;
                    }
                });
                
                elevations.push(elevation);
                velocitiesBarotropic.push(velBt);
                velocitiesBaroclinic.push(velBc);
            }
            
            // Store data globally
            tidalData = {
                times,
                elevations,
                velocitiesBarotropic,
                velocitiesBaroclinic,
                totalVelocities: velocitiesBarotropic.map((bt, i) => bt + velocitiesBaroclinic[i]),
                f,
                latitude,
                depth,
                analysisType
            };
            
            // Calculate statistics
            const maxElevation = Math.max(...elevations);
            const minElevation = Math.min(...elevations);
            const tidalRange = maxElevation - minElevation;
            
            const maxVelTotal = Math.max(...tidalData.totalVelocities.map(Math.abs));
            const maxVelBt = Math.max(...velocitiesBarotropic.map(Math.abs));
            const maxVelBc = Math.max(...velocitiesBaroclinic.map(Math.abs));
            
            // Display results
            displayResults({
                tidalRange,
                maxVelTotal,
                maxVelBt,
                maxVelBc,
                coriolisParam: f,
                latitude,
                depth
            });
            
            // Show initial chart
            showChart('elevation');
        }
        
        function displayResults(stats) {
            const container = document.getElementById('results');
            container.innerHTML = `
                <div class="result-item">
                    <h4>üåä Tidal Range</h4>
                    <p><strong>${stats.tidalRange.toFixed(3)} m</strong></p>
                    <small>Maximum - Minimum elevation</small>
                </div>
                <div class="result-item">
                    <h4>üí® Maximum Total Velocity</h4>
                    <p><strong>${stats.maxVelTotal.toFixed(4)} m/s</strong></p>
                    <small>Peak horizontal current speed</small>
                </div>
                <div class="result-item">
                    <h4>üîÑ Barotropic Velocity</h4>
                    <p><strong>${stats.maxVelBt.toFixed(4)} m/s</strong></p>
                    <small>Surface-uniform current</small>
                </div>
                <div class="result-item">
                    <h4>üåÄ Baroclinic Velocity</h4>
                    <p><strong>${stats.maxVelBc.toFixed(4)} m/s</strong></p>
                    <small>Depth-varying current</small>
                </div>
                <div class="result-item">
                    <h4>üåç Coriolis Parameter</h4>
                    <p><strong>${(stats.coriolisParam * 1e4).toFixed(3)} √ó 10‚Åª‚Å¥ s‚Åª¬π</strong></p>
                    <small>f = 2Œ© sin(œÜ)</small>
                </div>
                <div class="result-item">
                    <h4>üìç Analysis Location</h4>
                    <p><strong>${stats.latitude.toFixed(2)}¬∞N</strong></p>
                    <small>Depth: ${stats.depth} m</small>
                </div>
            `;
        }
        
        function showChart(type) {
            // Update toggle buttons
            document.querySelectorAll('.toggle-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            if (!tidalData) {
                alert('Please calculate tidal analysis first!');
                return;
            }
            
            const ctx = document.getElementById('tidalChart').getContext('2d');
            
            if (currentChart) {
                currentChart.destroy();
            }
            
            let chartData, chartOptions;
            
            switch (type) {
                case 'elevation':
                    chartData = {
                        labels: tidalData.times.slice(0, 200), // Show first 200 points for clarity
                        datasets: [{
                            label: 'Sea Level Elevation (m)',
                            data: tidalData.elevations.slice(0, 200),
                            borderColor: '#4ecdc4',
                            backgroundColor: 'rgba(78, 205, 196, 0.1)',
                            fill: true,
                            tension: 0.4
                        }]
                    };
                    chartOptions = {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            x: { title: { display: true, text: 'Time (hours)', color: '#333' } },
                            y: { title: { display: true, text: 'Elevation (m)', color: '#333' } }
                        },
                        plugins: {
                            title: { display: true, text: 'Tidal Elevation Time Series', color: '#333' }
                        }
                    };
                    break;
                    
                case 'velocity':
                    const datasets = [];
                    if (tidalData.analysisType === 'barotropic' || tidalData.analysisType === 'both') {
                        datasets.push({
                            label: 'Barotropic Velocity (m/s)',
                            data: tidalData.velocitiesBarotropic.slice(0, 200),
                            borderColor: '#ff6b6b',
                            backgroundColor: 'rgba(255, 107, 107, 0.1)',
                            fill: false
                        });
                    }
                    if (tidalData.analysisType === 'baroclinic' || tidalData.analysisType === 'both') {
                        datasets.push({
                            label: 'Baroclinic Velocity (m/s)',
                            data: tidalData.velocitiesBaroclinic.slice(0, 200),
                            borderColor: '#45b7d1',
                            backgroundColor: 'rgba(69, 183, 209, 0.1)',
                            fill: false
                        });
                    }
                    if (tidalData.analysisType === 'both') {
                        datasets.push({
                            label: 'Total Velocity (m/s)',
                            data: tidalData.totalVelocities.slice(0, 200),
                            borderColor: '#96ceb4',
                            backgroundColor: 'rgba(150, 206, 180, 0.1)',
                            fill: false,
                            borderWidth: 2
                        });
                    }
                    
                    chartData = {
                        labels: tidalData.times.slice(0, 200),
                        datasets: datasets
                    };
                    chartOptions = {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            x: { title: { display: true, text: 'Time (hours)', color: '#333' } },
                            y: { title: { display: true, text: 'Velocity (m/s)', color: '#333' } }
                        },
                        plugins: {
                            title: { display: true, text: 'Horizontal Tidal Velocities', color: '#333' }
                        }
                    };
                    break;
                    
                case 'spectrum':
                    // Simple frequency analysis
                    const frequencies = Object.values(tidalConstituents).map(c => 1/c.period);
                    const amplitudes = Object.values(tidalConstituents).map(c => c.amplitude);
                    const names = Object.keys(tidalConstituents);
                    
                    chartData = {
                        labels: names,
                        datasets: [{
                            label: 'Amplitude (m)',
                            data: amplitudes,
                            backgroundColor: [
                                '#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#feca57',
                                '#ff9ff3', '#54a0ff', '#5f27cd', '#00d2d3', '#ff9f43'
                            ],
                            borderWidth: 1
                        }]
                    };
                    chartOptions = {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: { title: { display: true, text: 'Amplitude (m)', color: '#333' } }
                        },
                        plugins: {
                            title: { display: true, text: 'Tidal Constituent Amplitudes', color: '#333' }
                        }
                    };
                    break;
            }
            
            currentChart = new Chart(ctx, {
                type: type === 'spectrum' ? 'bar' : 'line',
                data: chartData,
                options: chartOptions
            });
        }
        
        // Initialize the page
        displayTidalComponents();
        
        // Auto-calculate on page load
        setTimeout(() => {
            calculateTides();
        }, 500);
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96d0b72b5373b525',t:'MTc1NDg0MTcyNC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
